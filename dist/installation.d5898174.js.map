{"mappings":"qTA0BSA,EAAkBC,UAClBC,EAAA,SAAAC,WAAWF,GAGaG,eAClBC,EAAiBC,WAGZC,SAAY,QAAZA,SADMC,EAASF,EAAI,gBAAkBG,OAC9BC,MAAK,qBAAc,IAA1BH,OAA+B,EAA/BA,EAA6B,SAEtCI,eACPC,QAAQC,MAAMF,mBA8BIG,UACdC,EAAaC,EAAKC,EAAQC,WAAS,QAGnCC,EAAiB,WADc,UAAhBC,QAAQC,SAAoB,OAAS,IAGpDC,EAAsBN,EAAKD,EAAU,GAAKK,QAAQC,YAAYD,QAAQG,QAEtEC,wBAnEAC,EAAOL,QAAQM,IAAIC,QACV,iBAAJF,GAAyB,KAAJA,GAA+B,UAAhBL,QAAQC,sBAC3CnB,EAAA,SAAAC,WAAWa,EAAKS,EAAI,SAAU,UAC/BT,EAAKS,EAAI,SAAU,QAAS,SAAU,OAEtCT,EAAKS,EAAI,UAAW,UAEJ,UAAhBL,QAAQC,SAAoB,OAC/BO,EAAUR,QAAQM,IAAIG,WACV,iBAAPD,GAA+B,KAAPA,EAAO,OACjCZ,EAAKY,EAAO,SAAU,eAEX,iBAAJH,GAAyB,KAAJA,EAAI,OAClCT,EAAKS,EAAI,UAAW,iBAsDAK,GACvB7B,EAAae,EAAKQ,EAAgBL,MAEpCG,EAAmB,OACfS,EAAoBf,EAAKM,EAAqBH,SACxCnB,EAAkBC,SAtCwCG,OAC1C4B,EAAmBC,WAC3CC,SAAuBhC,EAAA,UAAoCiC,SAC1DC,EAAcC,SAAuBC,QAAQC,IAAG,CAAElC,EAAiB2B,GAAY3B,EAAiB4B,WAElF,iBAAZG,GACa,iBAAbC,GACK,KAAZD,GACa,KAAbC,IAEsD,IAA/CH,EAAcE,EAAcC,IA4BmBG,CAAiBvC,EAAY8B,gBArB7DT,EAA6BE,gBAC7CiB,SAAevC,EAAA,SACvBwC,KAAKC,cAAcC,QAAO,0CAEpBH,EAAKnB,EAAqBE,EAAc,CAAIqB,WAAW,IAC7DH,KAAKC,cAAcG,WAAU,oCAiBnBC,CAAWzB,EAAqBE,cAG5BxB,EAAkBC,IAC5ByC,KAAKC,cAAcK,SAAQ,uCACc5B,QAAQC,sEACGG,+BAIjDvB,8GAtFHO,EAAWyC,EAAUC,kCCL3BC,EAAAC,QAAkBd,QAAQe,QAAOC,QAAA,4DAAuFC,MAAI,IAAOrD,EAAa,0CCAhJiD,EAAAC,QAAkBd,QAAQe,QAAOC,QAAA,2DAAsFC,MAAI,IAAOrD,EAAa","sources":["src/installation.ts","node_modules/.pnpm/@parcel+runtime-js@2.0.0-beta.3.1/node_modules/@parcel/runtime-js/lib/runtime-99cc30e30df4c39559afc15ee155a60f.js","node_modules/.pnpm/@parcel+runtime-js@2.0.0-beta.3.1/node_modules/@parcel/runtime-js/lib/runtime-88b88cf76dc4567e14a0cf334ef7b117.js"],"sourcesContent":["import { pathExists } from \"fs-extra\"\nimport { join, dirname } from \"path\"\n\nimport { execFile as execFileRaw } from \"child_process\"\nimport { promisify } from \"util\"\nconst execFile = promisify(execFileRaw)\n\nasync function getCodeDBinFolder() {\n  const home = process.env.HOME\n  if (typeof home === \"string\" && home !== \"\" && process.platform === \"linux\") {\n    if (await pathExists(join(home, \".local\", \"share\"))) {\n      return join(home, \".local\", \"share\", \"code-d\", \"bin\")\n    } else {\n      return join(home, \".code-d\", \"bin\")\n    }\n  } else if (process.platform === \"win32\") {\n    const appdata = process.env.APPDATA\n    if (typeof appdata === \"string\" && appdata !== \"\") {\n      return join(appdata, \"code-d\", \"bin\")\n    }\n  } else if (typeof home === \"string\" && home !== \"\") {\n    return join(home, \".code-d\", \"bin\")\n  }\n  return \"\"\n}\n\nfunction isServeDInstalled(serveDPath: string) {\n  return pathExists(serveDPath)\n}\n\n/** Get the version of serve-d */\nasync function getServeDVersion(file: string) {\n  try {\n    const output = (await execFile(file, [\"--version\"])).stderr\n    const version = output.match(/v(\\d\\S*)\\s/)?.[1]\n    return version\n  } catch (e) {\n    console.error(e)\n    return undefined\n  }\n}\n\n/** Check if the given serve-d is up to date against the target version */\nasync function isServeDUpToDate(givenFile: string, targetFile: string) {\n  const semverCompare = (await import(\"semver/functions/compare\")).default\n  const [givenVersion, targetVersion] = await Promise.all([getServeDVersion(givenFile), getServeDVersion(targetFile)])\n  if (\n    typeof givenVersion === \"string\" &&\n    typeof targetVersion === \"string\" &&\n    givenVersion !== \"\" &&\n    targetVersion !== \"\"\n  ) {\n    return semverCompare(givenVersion, targetVersion) !== -1\n  } else {\n    // assume given version is old\n    return false\n  }\n}\n\nasync function copyServeD(bundledServerFolder: string, codeDBinFolder: string) {\n  const { copy } = await import(\"fs-extra\")\n  atom.notifications.addInfo(\"Installing/Updating D servers...\")\n  // copy the whole served folder\n  await copy(bundledServerFolder, codeDBinFolder, { overwrite: true })\n  atom.notifications.addSuccess(\"D servers was installed/updated\")\n}\n\nexport async function installServeD() {\n  const distFolder = join(dirname(__dirname), \"dist\")\n\n  const exeExtention = process.platform === \"win32\" ? \".exe\" : \"\"\n  const serveDExeFileName = `serve-d${exeExtention}`\n\n  const bundledServerFolder = join(distFolder, `${process.platform}-${process.arch}`)\n\n  const codeDBinFolder = await getCodeDBinFolder()\n  const serveDPath = join(codeDBinFolder, serveDExeFileName)\n\n  if (bundledServerFolder) {\n    const bundledServeDPath = join(bundledServerFolder, serveDExeFileName)\n    if (!(await isServeDInstalled(serveDPath)) || !(await isServeDUpToDate(serveDPath, bundledServeDPath))) {\n      await copyServeD(bundledServerFolder, codeDBinFolder)\n    }\n  } else {\n    if (!(await isServeDInstalled(serveDPath))) {\n      atom.notifications.addError(\n        `serve-d binary is not available for ${process.platform}.\n        Please built it from the source, place it under ${codeDBinFolder}, and restart Atom.`\n      )\n    }\n  }\n  return serveDPath\n}\n","module.exports = (Promise.resolve(__parcel__require__(\"./\" + \"fs-extra.51728e42.js\"))).then(() => parcelRequire('5dfor'));","module.exports = (Promise.resolve(__parcel__require__(\"./\" + \"compare.05805253.js\"))).then(() => parcelRequire('6g2vW'));"],"names":["$ba7d7673c8e77e7c46c6e2f01e274986$var$isServeDInstalled","serveDPath","parcelRequire","pathExists","async","$ba7d7673c8e77e7c46c6e2f01e274986$var$getServeDVersion","file","ref","$ba7d7673c8e77e7c46c6e2f01e274986$var$execFile","stderr","match","e","console","error","$ba7d7673c8e77e7c46c6e2f01e274986$export$5109a6445e36b1c","distFolder","$6yR9B$join","$6yR9B$dirname","__dirname","serveDExeFileName","process","platform","bundledServerFolder","arch","codeDBinFolder","home","env","HOME","appdata","APPDATA","$ba7d7673c8e77e7c46c6e2f01e274986$var$getCodeDBinFolder","bundledServeDPath","givenFile","targetFile","semverCompare","default","givenVersion","targetVersion","Promise","all","$ba7d7673c8e77e7c46c6e2f01e274986$var$isServeDUpToDate","copy","atom","notifications","addInfo","overwrite","addSuccess","$ba7d7673c8e77e7c46c6e2f01e274986$var$copyServeD","addError","$6yR9B$promisify","$6yR9B$execFile","module","exports","resolve","require","then"],"version":3,"file":"installation.d5898174.js.map"}